<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Format | dr4</title>
    <meta name="description" content="The modern, binary object-oriented format">
    
    
    <link rel="preload" href="/site/assets/css/0.styles.bedfde85.css" as="style"><link rel="preload" href="/site/assets/js/app.7689fc65.js" as="script"><link rel="preload" href="/site/assets/js/2.0d102074.js" as="script"><link rel="preload" href="/site/assets/js/8.febe2f32.js" as="script"><link rel="prefetch" href="/site/assets/js/10.08ba5329.js"><link rel="prefetch" href="/site/assets/js/11.301aeb7b.js"><link rel="prefetch" href="/site/assets/js/12.02e1ec56.js"><link rel="prefetch" href="/site/assets/js/13.d72600a1.js"><link rel="prefetch" href="/site/assets/js/3.0da6d1b4.js"><link rel="prefetch" href="/site/assets/js/4.7e2eaab0.js"><link rel="prefetch" href="/site/assets/js/5.e601087b.js"><link rel="prefetch" href="/site/assets/js/6.14e23d89.js"><link rel="prefetch" href="/site/assets/js/7.5dad409f.js"><link rel="prefetch" href="/site/assets/js/9.fa43cb14.js">
    <link rel="stylesheet" href="/site/assets/css/0.styles.bedfde85.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/site/" class="home-link router-link-active"><!----> <span class="site-name">dr4</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="/site/faq.html" class="nav-link">FAQ</a></div><div class="nav-item"><a href="/site/spec/" class="nav-link">Spec</a></div><div class="nav-item"><a href="/site/format.html" class="nav-link router-link-exact-active router-link-active">Format</a></div><div class="nav-item"><a href="/site/projects/" class="nav-link">Projects</a></div> <a href="https://github.com/dr4f" target="_blank" rel="noopener noreferrer" class="repo-link">
    dr4 on GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/site/" class="nav-link">Home</a></div><div class="nav-item"><a href="/site/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="/site/faq.html" class="nav-link">FAQ</a></div><div class="nav-item"><a href="/site/spec/" class="nav-link">Spec</a></div><div class="nav-item"><a href="/site/format.html" class="nav-link router-link-exact-active router-link-active">Format</a></div><div class="nav-item"><a href="/site/projects/" class="nav-link">Projects</a></div> <a href="https://github.com/dr4f" target="_blank" rel="noopener noreferrer" class="repo-link">
    dr4 on GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Format</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/site/format.html#document-header" class="sidebar-link">Document Header</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/format.html#structure" class="sidebar-link">Structure</a></li><li class="sidebar-sub-header"><a href="/site/format.html#magic-sequence" class="sidebar-link">Magic Sequence</a></li><li class="sidebar-sub-header"><a href="/site/format.html#version" class="sidebar-link">Version</a></li><li class="sidebar-sub-header"><a href="/site/format.html#reserved-bytes" class="sidebar-link">Reserved Bytes</a></li></ul></li><li><a href="/site/format.html#document-body" class="sidebar-link">Document Body</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/format.html#structure-2" class="sidebar-link">Structure</a></li><li class="sidebar-sub-header"><a href="/site/format.html#termination-sequence" class="sidebar-link">Termination Sequence</a></li><li class="sidebar-sub-header"><a href="/site/format.html#row-list" class="sidebar-link">Row List</a></li></ul></li><li><a href="/site/format.html#row" class="sidebar-link">Row</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/format.html#row-header" class="sidebar-link">Row Header</a></li><li class="sidebar-sub-header"><a href="/site/format.html#row-body" class="sidebar-link">Row Body</a></li><li class="sidebar-sub-header"><a href="/site/format.html#endianess" class="sidebar-link">Endianess</a></li></ul></li><li><a href="/site/format.html#examples" class="sidebar-link">Examples</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/site/format.html#single-row-single-field" class="sidebar-link">Single Row, Single Field</a></li><li class="sidebar-sub-header"><a href="/site/format.html#only-row-two-heterogeneous-fields" class="sidebar-link">Only Row, Two Heterogeneous Fields</a></li><li class="sidebar-sub-header"><a href="/site/format.html#invalid-row-length" class="sidebar-link">Invalid Row - length</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content default"><h1 id="format"><a href="#format" aria-hidden="true" class="header-anchor">#</a> Format</h1> <p>The <code>dr4</code> format can best be described in the form of <em>documents</em>. Documents are composed of both a header and a body. At a high level, they symbolize a collection of <em>data rows</em>. At the document level, an 8-byte header at the beginning of the document stores the information needed to process the body. This information consists of a 3 byte <em>magic</em> sequence, a 3 byte versioning sequeunce, and 2 bytes that are currently reserved for future use. The 2 byte sequence will likely be used to handle different variants of the <code>dr4</code> format.</p> <h2 id="document-header"><a href="#document-header" aria-hidden="true" class="header-anchor">#</a> Document Header</h2> <p>The 8-byte document header is structured with the following representation.</p> <div class="language- extra-class"><pre class="language-text"><code>[83][94][121]  [0][0][1]    [0][0]
     |             |           |
  magic seq     version    reserved
</code></pre></div><h3 id="structure"><a href="#structure" aria-hidden="true" class="header-anchor">#</a> Structure</h3> <p>In the above format, the header is composed of three parts. Each <code>[]</code> represents a single unsigned 8-bit integer, ranging in value in decimal form between <code>0</code> to <code>255</code>. The values of the magic sequence are absolute, they represent the values that almost be present to validate the document. The version and reserved bytes are just examples. However, the version must be a valid version.</p> <h3 id="magic-sequence"><a href="#magic-sequence" aria-hidden="true" class="header-anchor">#</a> Magic Sequence</h3> <p>The magic sequence of <code>dr4</code>, <code>83, 94, 121</code>, serves as a validation or marked start of a dr4 document. This also helps if a <code>dr4</code> document is packed into a string or a file, or if multiple <code>dr4</code> documents need to be joined together in a file. This will sequence will never change.</p> <h3 id="version"><a href="#version" aria-hidden="true" class="header-anchor">#</a> Version</h3> <p>The version of <code>dr4</code> the document corresponds to is represented by three 8-bit unsigned integers. They each respectively indicate:</p> <ul><li>First byte : The major release number</li> <li>Second byte : The minor release number</li> <li>Third byte : The patch number</li></ul> <p>The major release number is incremented the most seldomly, while the third byte is incremented the most frequently. <code>dr4</code> is not a software package or library, it is a specification for a data or file format. The only real difference between versions are the formats, sizes, or structures of the data types present in fields. All versions are backwards compatible to one another. The format of the file or rows will not change between versions.</p> <h3 id="reserved-bytes"><a href="#reserved-bytes" aria-hidden="true" class="header-anchor">#</a> Reserved Bytes</h3> <p>The last two 8-bit unsigned bytes of the header are reserved for future use. Most likely, they will be used to represent variants of the <code>dr4</code> document that will be handled differently. Such as, if the main form of the <code>dr4</code> document stores the sizes and offsets as 32-bit unsigned integers, another variant might only use 16-bit unsigned integers.</p> <h2 id="document-body"><a href="#document-body" aria-hidden="true" class="header-anchor">#</a> Document Body</h2> <p>The document body consists of a sequence of data rows. Each row occupies a fixed amount of bytes, denoted by a size field within it's header. The sequence of rows is terminated by a four byte sequence containing all zeroes.</p> <h3 id="structure-2"><a href="#structure-2" aria-hidden="true" class="header-anchor">#</a> Structure</h3> <p>The overall document body can be represented by the following structure:</p> <div class="language- extra-class"><pre class="language-text"><code>(row list)   [0][0][0][0]
   |               |
  rows        Termination Seq
</code></pre></div><h3 id="termination-sequence"><a href="#termination-sequence" aria-hidden="true" class="header-anchor">#</a> Termination Sequence</h3> <p>The sequence of 8-bit unsigned integers <code>0, 0, 0, 0</code> marks the end of a <code>dr4</code> document.</p> <p>The true role of the termination sequence is to symbolize a value of <code>0</code>. There is no specificed limit to the size of <code>dr4</code> documents. Therefore, if a document is intended to be read row by row, as opposed to in a single chunk, the termination sequence provides a stopping point.</p> <h3 id="row-list"><a href="#row-list" aria-hidden="true" class="header-anchor">#</a> Row List</h3> <p>The <em>row list</em>, pictured above is a finite sequence of data rows. These rows each contain their own header and body. The first four bytes of any row correspond to it's total size in bytes. No row can ever have a size of zero, or be &quot;empty&quot;.</p> <p>The reason the termination sequence of the document is four bytes long and not 1 is if the document is read row by row, when a size of zero is detected to read the next row, it must be the end of the document, as no row may have a size of zero.</p> <h2 id="row"><a href="#row" aria-hidden="true" class="header-anchor">#</a> Row</h2> <p>The most important element of a <code>dr4</code> document is the <em>row</em>. A row, also called a data row, is a binary, fixed size object, that contains an arbitrary number of fields. The row is divided between a header and a body. The header contains the size, number of fields, and an array to hold the offsets of each field. The body contains the packed, binary data values for the fields.</p> <h3 id="row-header"><a href="#row-header" aria-hidden="true" class="header-anchor">#</a> Row Header</h3> <p>The row header is divided into three segments, the size, the length (number of fields), and the offset array. The size and length are both unsigned 32-bit integers, while the offset array is just a series of 32-bit unsigned integers. The <em>length of the offset array</em> is always equal to the value in the <em>length header field</em>. The structure of the row header is depicted below:</p> <div class="language- extra-class"><pre class="language-text"><code> (size)       (length)            (offsets...)
   |             |                    |
[uint-32]    [uint-32]     [uint-32]_1 ... [uint-32]_n
</code></pre></div><h4 id="size"><a href="#size" aria-hidden="true" class="header-anchor">#</a> Size</h4> <p>The size value of a row header always refers to the size of the row <em>not</em> including the unsigned 32-bit integer used to store the size. The size of a row can never be 0. In the future, there may be variant formats of <code>dr4</code> that use smaller or larger max sizes of rows.</p> <h4 id="length"><a href="#length" aria-hidden="true" class="header-anchor">#</a> Length</h4> <p>The length value of a row header refers to the number of fields in a row. It is stored as a 32-bit unsigned integer (4 byte sequence) right after the size. It, like the size, can never be 0.</p> <h4 id="offsets"><a href="#offsets" aria-hidden="true" class="header-anchor">#</a> Offsets</h4> <p>The offsets array of a row header stores the byte offset at which each field exists in the row. Each offset refers to the offset from the first byte of the <em>row body</em>, not the header. The first offset in the array is always 0, as the first field always starts right after the header portion of the row ends. Attempting to index an offset array with an integer greater than the <em>length</em> of the row is invalid.</p> <h3 id="row-body"><a href="#row-body" aria-hidden="true" class="header-anchor">#</a> Row Body</h3> <p>The row body consists of the packed data for the fields in a row. Every field within the body contains a mark byte, a single 8-bit unsigned integer to indicate the field's type, followed by additional data the field contains. The entire set of supported types is discussed in details in the <code>dr4</code> specification.</p> <p>The row body always ends with a <code>0</code> byte. In the type systen, this is referred to as the <code>stop</code> type. This byte is accounted for in the <em>size</em> value of the row header. The offset of the stop byte is not stored in the offset array, nor is it counted as part of the <em>length</em> value in the header.</p> <p>An example row body is as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>\x_none \x_none \x_bool \x01 \x_stop
</code></pre></div><p><strong>Note</strong>: This example uses a different byte notation, where an element prefixed with <code>\x</code> indicates an 8-bit unsigned integer. Named bytes, such as <code>\x_none</code> each correspond to different bytes, but for visualization their values are replaced with names.</p> <p>In this row body, we have two <code>none</code> fields, followed by a boolean field who's value is true, followed by the stop byte.</p> <h3 id="endianess"><a href="#endianess" aria-hidden="true" class="header-anchor">#</a> Endianess</h3> <p>For now, <code>dr4</code> does not support a specific endian format. Since <code>dr4</code> was originally developed on a unix platform, all of the binary representations here are in little endian form. Satisfying the <code>dr4</code> spec does not require a specific endian, just the arrangements and positions of specific values.</p> <h2 id="examples"><a href="#examples" aria-hidden="true" class="header-anchor">#</a> Examples</h2> <p>Given the explanation of the <code>dr4</code> document format, this section will provide some full, binary examples of documents.</p> <h3 id="single-row-single-field"><a href="#single-row-single-field" aria-hidden="true" class="header-anchor">#</a> Single Row, Single Field</h3> <p>Below is a document with a single row, and one item in that row</p> <div class="language- extra-class"><pre class="language-text"><code>\x83\x94\x121\x00\x00\x01\x00\x00 -&gt; doc header
\x14\x00\x00\x00 -&gt; row size
\x01\x00\x00\x00 -&gt; row length
\x00\x00\x00\x00 -&gt; offset array
\x_none\x_stop -&gt; row body
\x00\x00\x00\x00 -&gt; doc term
</code></pre></div><h3 id="only-row-two-heterogeneous-fields"><a href="#only-row-two-heterogeneous-fields" aria-hidden="true" class="header-anchor">#</a> Only Row, Two Heterogeneous Fields</h3> <p>An example of a row (not an entire document), with two differently typed fields</p> <div class="language- extra-class"><pre class="language-text"><code>\x20\x00\x00\x00 \x02\x00\x00\x00 \x00\x00\x00\x00 \x02\x00\x00\x00 \x_bool\x00 \x_bool\x01 \x_stop
|______________| |______________| |______________| |______________| |_________|_|__________|______|
       |                |                |                |                      |            |
      size            length           offset_1        offset_2              fields         stop
</code></pre></div><h3 id="invalid-row-length"><a href="#invalid-row-length" aria-hidden="true" class="header-anchor">#</a> Invalid Row - length</h3> <p>Here is an example of a row which it's length header value is greater than the number offsets it's header carries.</p> <div class="language- extra-class"><pre class="language-text"><code>\x17\x00\x00\x00 \x05\x00\x00\x00 \x00\x00\x00\x00  \x_si32\x30\x02\x00\x00  \x_stop
|______________| |______________| |______________|  |________________________|______|
       |                |                |                      |               |
      size            length           offset_1               fields           stop
</code></pre></div><p><em>Note</em>: <code>\x_si32</code> indicates the type for a signed 32-bit integer.</p></div> <!----> <!----> </div></div><div class="global-ui"></div></div>
    <script src="/site/assets/js/2.0d102074.js" defer></script><script src="/site/assets/js/8.febe2f32.js" defer></script><script src="/site/assets/js/app.7689fc65.js" defer></script>
  </body>
</html>
